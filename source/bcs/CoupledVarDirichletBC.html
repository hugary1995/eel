<!DOCTYPE html><head><meta charset="UTF-8"><title>CoupledVarDirichletBC | Eel</title><link href="../../contrib/materialize/materialize.min.css" type="text/css" rel="stylesheet" media="screen,projection"></link><link href="../../contrib/prism/prism.min.css" type="text/css" rel="stylesheet"></link><link href="../../css/moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/devel_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/alert_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/content_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/sqa_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/civet_moose.css" type="text/css" rel="stylesheet"></link><link href="../../contrib/katex/katex.min.css" type="text/css" rel="stylesheet"></link><link href="../../css/katex_moose.css" type="text/css" rel="stylesheet"></link><script type="text/javascript" src="../../contrib/jquery/jquery.min.js"></script><script type="text/javascript" src="../../contrib/katex/katex.min.js"></script></head><body><div class="page-wrap"><header><nav><div class="nav-wrapper container"><a href="../../index.html" class="left moose-logo hide-on-med-and-down" id="home-button">Eel</a><a href="https://github.com/hugary1995/eel" class="right"><img src="../../media/framework/github-logo.png" class="github-mark"></img><img src="../../media/framework/github-mark.png" class="github-logo"></img></a><ul class="right hide-on-med-and-down"><li><a href="../../eel.html">Documentation</a></li></ul><a href="#" class="sidenav-trigger" data-target="354b4d79-8b5f-435e-88e0-5392c3791940"><i class="material-icons">menu</i></a><ul class="sidenav" id="354b4d79-8b5f-435e-88e0-5392c3791940"><li><a href="../../eel.html">Documentation</a></li></ul><a href="#moose-search" class="modal-trigger"><i class="material-icons">search</i></a></div></nav><div class="modal modal-fixed-footer moose-search-modal" id="moose-search"><div class="modal-content container moose-search-modal-content"><div class="row"><div class="col l12"><div class="input-field"><input type_="text" onkeyup="mooseSearch()" placeholder="/index.md" id="moose-search-box"></input></div></div><div><div class="col s12" id="moose-search-results"></div></div></div></div><div class="modal-footer"><a href="#!" class="modal-close btn-flat">Close</a></div></div></header><main class="main"><div class="container"><div class="row"><div class="col hide-on-med-and-down l12"><nav class="breadcrumb-nav"><div class="nav-wrapper"><a href=".." class="breadcrumb">source</a><span class="breadcrumb">bcs</span><a href="#" class="breadcrumb">CoupledVarDirichletBC</a></div></nav></div></div><div class="row"><div class="moose-content col s12 m12 l10"><section id="a945585d-0e6e-483e-9c19-c435912d6e88" data-section-level="1" data-section-text="CoupledVarDirichletBC"><h1 id="coupledvardirichletbc">CoupledVarDirichletBC</h1><div class="card moose-alert moose-alert-construction"><div class="card-title moose-alert-title"><i class="material-icons moose-inline-icon">build</i><span class="moose-alert-title-brand">construction:</span>Undocumented Class</div><div class="card-content"><div class="moose-alert-content"><p>The CoupledVarDirichletBC has not been documented. The content listed below should be used as a starting point for documenting the class, which includes the typical automatic documentation associated with a MooseObject; however, what is contained is ultimately determined by what is necessary to make the documentation clear for users.</p></div></div></div><p>Imposes the essential boundary condition <span class="moose-katex-inline-equation" id="moose-equation-7d504c95-1375-41fd-8519-46f47e398ba8"><script>var element = document.getElementById("moose-equation-7d504c95-1375-41fd-8519-46f47e398ba8");katex.render("u=g", element, {displayMode:false,throwOnError:false,macros:{"\\bs":"\\boldsymbol{#1}","\\grad":"\\bs{\\nabla}","\\divergence":"\\grad \\cdot","\\norm":"\\left\\lVert#1\\right\\rVert","\\abs":"\\left\\lvert#1\\right\\rvert","\\diff":"\\text{ d}#1","\\bfa":"\\boldsymbol{a}","\\bfb":"\\boldsymbol{b}","\\bfc":"\\boldsymbol{c}","\\bfd":"\\boldsymbol{d}","\\bfe":"\\boldsymbol{e}","\\bff":"\\boldsymbol{f}","\\bfg":"\\boldsymbol{g}","\\bfh":"\\boldsymbol{h}","\\bfi":"\\boldsymbol{i}","\\bfj":"\\boldsymbol{j}","\\bfk":"\\boldsymbol{k}","\\bfl":"\\boldsymbol{l}","\\bfm":"\\boldsymbol{m}","\\bfn":"\\boldsymbol{n}","\\bfo":"\\boldsymbol{o}","\\bfp":"\\boldsymbol{p}","\\bfq":"\\boldsymbol{q}","\\bfr":"\\boldsymbol{r}","\\bfs":"\\boldsymbol{s}","\\bft":"\\boldsymbol{t}","\\bfu":"\\boldsymbol{u}","\\bfv":"\\boldsymbol{v}","\\bfw":"\\boldsymbol{w}","\\bfx":"\\boldsymbol{x}","\\bfy":"\\boldsymbol{y}","\\bfz":"\\boldsymbol{z}","\\bfA":"\\boldsymbol{A}","\\bfB":"\\boldsymbol{B}","\\bfC":"\\boldsymbol{C}","\\bfD":"\\boldsymbol{D}","\\bfE":"\\boldsymbol{E}","\\bfF":"\\boldsymbol{F}","\\bfG":"\\boldsymbol{G}","\\bfH":"\\boldsymbol{H}","\\bfI":"\\boldsymbol{I}","\\bfJ":"\\boldsymbol{J}","\\bfK":"\\boldsymbol{K}","\\bfL":"\\boldsymbol{L}","\\bfM":"\\boldsymbol{M}","\\bfN":"\\boldsymbol{N}","\\bfO":"\\boldsymbol{O}","\\bfP":"\\boldsymbol{P}","\\bfQ":"\\boldsymbol{Q}","\\bfR":"\\boldsymbol{R}","\\bfS":"\\boldsymbol{S}","\\bfT":"\\boldsymbol{T}","\\bfU":"\\boldsymbol{U}","\\bfV":"\\boldsymbol{V}","\\bfW":"\\boldsymbol{W}","\\bfX":"\\boldsymbol{X}","\\bfY":"\\boldsymbol{Y}","\\bfZ":"\\boldsymbol{Z}"}});</script></span></p><section class="scrollspy" id="037e8303-9bf8-4f2a-a9a7-6f06310f4049" data-section-level="2" data-section-text="Overview"><h2 id="overview">Overview</h2><p></p></section><section class="scrollspy" id="e6818109-2186-49b3-b69f-190164f5844d" data-section-level="2" data-section-text="Example Input File Syntax"><h2 id="example-input-file-syntax">Example Input File Syntax</h2><p></p></section><section class="scrollspy" id="eefe8b6b-0513-4145-a11c-4aae0dd2981a" data-section-level="2" data-section-text="Input Parameters"><h2 id="input-parameters">Input Parameters</h2><section id="2da0d3d2-746c-4bba-8b2b-bf02544afa1c" data-section-level="3" data-section-text="Required Parameters" data-details-open="open"><details class="moose-section-content" open="open"><ul class="collapsible" data-collapsible="expandable"><li><div class="collapsible-header"><span class="moose-parameter-name">boundary</span><span class="moose-parameter-header-description">The list of boundary IDs from the mesh where this object applies</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;BoundaryName&gt;</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The list of boundary IDs from the mesh where this object applies</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">value</span><span class="moose-parameter-header-description">Value of the BC</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;VariableName&gt;</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Value of the BC</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">variable</span><span class="moose-parameter-header-description">The name of the variable that this residual object operates on</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>NonlinearVariableName</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The name of the variable that this residual object operates on</p></div></li></ul><summary><h3 data-details-open="open"><span class="moose-section-icon"></span>Required Parameters</h3></summary></details></section><section id="8d02926f-fa30-4138-b8a5-8eea52fdb48d" data-section-level="3" data-section-text="Optional Parameters" data-details-open="open"><details class="moose-section-content" open="open"><ul class="collapsible" data-collapsible="expandable"><li><div class="collapsible-header"><span class="moose-parameter-name">diag_save_in</span><span class="moose-parameter-header-description">The name of auxiliary variables to save this BC's diagonal jacobian contributions to.  Everything about that variable must match everything about this variable (the type, what blocks it's on, etc.)</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;AuxVariableName&gt;</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The name of auxiliary variables to save this BC's diagonal jacobian contributions to.  Everything about that variable must match everything about this variable (the type, what blocks it's on, etc.)</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">displacements</span><span class="moose-parameter-header-description">The displacements</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;VariableName&gt;</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The displacements</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">preset</span><span class="moose-parameter-header-default">True</span><span class="moose-parameter-header-description">Whether or not to preset the BC (apply the value before the solve begins).</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>True</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>bool</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Whether or not to preset the BC (apply the value before the solve begins).</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">save_in</span><span class="moose-parameter-header-description">The name of auxiliary variables to save this BC's residual contributions to.  Everything about that variable must match everything about this variable (the type, what blocks it's on, etc.)</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;AuxVariableName&gt;</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The name of auxiliary variables to save this BC's residual contributions to.  Everything about that variable must match everything about this variable (the type, what blocks it's on, etc.)</p></div></li></ul><summary><h3 data-details-open="open"><span class="moose-section-icon"></span>Optional Parameters</h3></summary></details></section><section id="9b535bfd-fca0-4a69-a108-e51fa6d1eeeb" data-section-level="3" data-section-text="Tagging Parameters" data-details-open="close"><details class="moose-section-content"><ul class="collapsible" data-collapsible="expandable"><li><div class="collapsible-header"><span class="moose-parameter-name">absolute_value_vector_tags</span><span class="moose-parameter-header-description">The tags for the vectors this residual object should fill with the absolute value of the residual contribution</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;TagName&gt;</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The tags for the vectors this residual object should fill with the absolute value of the residual contribution</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">extra_matrix_tags</span><span class="moose-parameter-header-description">The extra tags for the matrices this Kernel should fill</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;TagName&gt;</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The extra tags for the matrices this Kernel should fill</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">extra_vector_tags</span><span class="moose-parameter-header-description">The extra tags for the vectors this Kernel should fill</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;TagName&gt;</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The extra tags for the vectors this Kernel should fill</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">matrix_tags</span><span class="moose-parameter-header-default">system time</span><span class="moose-parameter-header-description">The tag for the matrices this Kernel should fill</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>system time</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>MultiMooseEnum</p><p class="moose-parameter-description-options"><span>Options:</span>nontime, system, time</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The tag for the matrices this Kernel should fill</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">vector_tags</span><span class="moose-parameter-header-default">residual</span><span class="moose-parameter-header-description">The tag for the vectors this Kernel should fill</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>residual</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>MultiMooseEnum</p><p class="moose-parameter-description-options"><span>Options:</span>nontime, time, residual</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The tag for the vectors this Kernel should fill</p></div></li></ul><summary><h3 data-details-open="close"><span class="moose-section-icon"></span>Tagging Parameters</h3></summary></details></section><section id="48914d47-dd49-455b-afa6-5dee16afcc53" data-section-level="3" data-section-text="Advanced Parameters" data-details-open="close"><details class="moose-section-content"><ul class="collapsible" data-collapsible="expandable"><li><div class="collapsible-header"><span class="moose-parameter-name">control_tags</span><span class="moose-parameter-header-description">Adds user-defined labels for accessing object parameters via control logic.</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;std::string&gt;</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Adds user-defined labels for accessing object parameters via control logic.</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">enable</span><span class="moose-parameter-header-default">True</span><span class="moose-parameter-header-description">Set the enabled status of the MooseObject.</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>True</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>bool</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>Yes</p><p class="moose-parameter-description"><span>Description:</span>Set the enabled status of the MooseObject.</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">implicit</span><span class="moose-parameter-header-default">True</span><span class="moose-parameter-header-description">Determines whether this object is calculated using an implicit or explicit form</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>True</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>bool</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Determines whether this object is calculated using an implicit or explicit form</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">seed</span><span class="moose-parameter-header-default">0</span><span class="moose-parameter-header-description">The seed for the master random number generator</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>0</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>unsigned int</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The seed for the master random number generator</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">use_displaced_mesh</span><span class="moose-parameter-header-default">False</span><span class="moose-parameter-header-description">Whether or not this object should use the displaced mesh for computation.  Note that in the case this is true but no displacements are provided in the Mesh block the undisplaced mesh will still be used.</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>False</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>bool</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Whether or not this object should use the displaced mesh for computation.  Note that in the case this is true but no displacements are provided in the Mesh block the undisplaced mesh will still be used.</p></div></li></ul><summary><h3 data-details-open="close"><span class="moose-section-icon"></span>Advanced Parameters</h3></summary></details></section></section><section class="scrollspy" id="3b7c4eea-228f-41c9-813f-b36c95cdb3a5" data-section-level="2" data-section-text="Input Files"><h2 id="input-files">Input Files</h2><ul class="moose-list-inputs browser-default"><li><a class="moose-source-filename tooltipped modal-trigger" href="#df973dfa-001a-4064-aea4-b791c9c5fa77">(examples/SSB/CV_charging.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#cfe65e05-3170-421d-9665-6fa1c49c21d7">(examples/degradation/CV_charging.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#875cea40-95a1-4658-a8a3-7bff86b28c6d">(examples/SSB_3D/CV_charging.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#c95b98e3-2bc5-4181-af55-649d6ea129d3">(examples/degradation/CV_discharging.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#83bcefb5-7734-434a-82c7-ef0a68d0dfac">(examples/LiB/CV_charging.i)</a></li></ul></section></section><div class="moose-modal modal" id="df973dfa-001a-4064-aea4-b791c9c5fa77"><div class="modal-content"><h4>(examples/SSB/CV_charging.i)</h4><pre class="moose-pre"><code class="language-text">I = 0.005 #mA
width = 0.05 #mm
in = &#x27;${fparse -I/width}&#x27;
t0 = &#x27;${fparse -1e-2/in}&#x27;

sigma_a = 0.2 #mS/mm
sigma_e = 0.1 #mS/mm
sigma_cp = 0.05 #mS/mm
sigma_ca = 0.2 #mS/mm
sigma_cm = 0.05 #mS/mm

Phi_penalty = 10

cmin_a = 1e-4 #mmol/mm^3
cmax_a = 1e-3 #mmol/mm^3
c_e = 5e-4 #mmol/mm^3
cmax_c = 1e-3 #mmol/mm^3
c_ref_entropy = 5e-5
D_cp = 5e-5 #mm^2/s
D_cm = 1e-4 #mm^2/s
D_a = 5e-4 #mm^2/s
D_e = 1e-4 #mm^2/s

c_penalty = 1

R = 8.3145 #mJ/mmol/K
T0 = 300 #K
F = 96485 #mC/mmol

i0_a = 1e-1 #mA/mm^2
i0_c = 1e-1 #mA/mm^2

E_cp = 6e4
E_cm = 5e4
E_e = 5e4
E_a = 1e5
nu_cp = 0.3
nu_cm = 0.25
nu_e = 0.25
nu_a = 0.3

u_penalty = 1e8

Omega = 140
beta = 1e-4
CTE = 1e-5

rho = 2.5e-9 #Mg/mm^3
cv = 2.7e8 #mJ/Mg/K
kappa = 2e-4 #mJ/mm/K/s
htc = 9.5e-3

T_penalty = 1

[GlobalParams]
  energy_densities = &#x27;dot(psi_m) dot(psi_c) chi q q_ca zeta&#x27;
  deformation_gradient = F
  mechanical_deformation_gradient = Fm
  eigen_deformation_gradient = Fg
  swelling_deformation_gradient = Fs
  thermal_deformation_gradient = Ft
  displacements = &#x27;disp_x disp_y&#x27;
[]

[Problem]
  restart_file_base = &#x27;CC_charging_out_cp/LATEST&#x27;
[]

[Mesh]
  [battery]
    type = FileMeshGenerator
    file = &#x27;gold/ssb.msh&#x27;
  []
  [interfaces]
    type = BreakMeshByBlockGenerator
    input = battery
    add_interface_on_two_sides = true
    split_interface = true
  []
  use_displaced_mesh = false
[]

[Variables]
  [Phi_ca]
    block = cm
  []
  [Phi]
  []
  [c]
  []
  [disp_x]
  []
  [disp_y]
  []
  [T]
  []
[]

[AuxVariables]
  [c_ref]
  []
  [T_ref]
    initial_condition = ${T0}
  []
  [stress]
    order = CONSTANT
    family = MONOMIAL
    [AuxKernel]
      type = ADRankTwoScalarAux
      rank_two_tensor = pk1
      scalar_type = Hydrostatic
      execute_on = &#x27;INITIAL TIMESTEP_END&#x27;
    []
  []
  [Js]
    order = CONSTANT
    family = MONOMIAL
    [AuxKernel]
      type = ADRankTwoScalarAux
      rank_two_tensor = Fs
      scalar_type = ThirdInvariant
      execute_on = &#x27;INITIAL TIMESTEP_END&#x27;
    []
  []
  [Jt]
    order = CONSTANT
    family = MONOMIAL
    [AuxKernel]
      type = ADRankTwoScalarAux
      rank_two_tensor = Ft
      scalar_type = ThirdInvariant
      execute_on = &#x27;INITIAL TIMESTEP_END&#x27;
    []
  []
  [Phi0]
    [AuxKernel]
      type = ParsedAux
      function = &#x27;Phi&#x27;
      args = &#x27;Phi&#x27;
      execute_on = &#x27;INITIAL&#x27;
    []
  []
[]

[ICs]
  [c_ref_a]
    type = ConstantIC
    variable = c_ref
    value = ${cmin_a}
    block = &#x27;a&#x27;
  []
  [c_ref_e]
    type = ConstantIC
    variable = c_ref
    value = ${c_e}
    block = &#x27;cm e&#x27;
  []
  [c_ref_c]
    type = ConstantIC
    variable = c_ref
    value = ${cmax_c}
    block = &#x27;cp&#x27;
  []
[]

[Kernels]
  # Charge balance
  [charge_balance]
    type = RankOneDivergence
    variable = Phi
    vector = i
  []
  [charge_balance_ca]
    type = RankOneDivergence
    variable = Phi_ca
    vector = i_ca
    block = cm
  []
  # Mass balance
  [mass_balance_1]
    type = TimeDerivative
    variable = c
  []
  [mass_balance_2]
    type = RankOneDivergence
    variable = c
    vector = j
  []
  # Momentum balance
  [momentum_balance_x]
    type = RankTwoDivergence
    variable = disp_x
    component = 0
    tensor = pk1
    factor = -1
  []
  [momentum_balance_y]
    type = RankTwoDivergence
    variable = disp_y
    component = 1
    tensor = pk1
    factor = -1
  []
  # Energy balance
  [energy_balance_1]
    type = EnergyBalanceTimeDerivative
    variable = T
    density = rho
    specific_heat = cv
  []
  [energy_balance_2]
    type = RankOneDivergence
    variable = T
    vector = h
  []
  [heat_source]
    type = MaterialSource
    variable = T
    prop = r
    coefficient = -1
  []
[]

[InterfaceKernels]
  [negative_current]
    type = MaterialInterfaceNeumannBC
    variable = Phi
    neighbor_var = Phi
    prop = ie
    factor = -1
    boundary = &#x27;e_a cp_cm&#x27;
  []
  [positive_current]
    type = MaterialInterfaceNeumannBC
    variable = Phi
    neighbor_var = Phi
    prop = ie
    boundary = &#x27;a_e cm_cp&#x27;
  []
  [negative_mass]
    type = MaterialInterfaceNeumannBC
    variable = c
    neighbor_var = c
    prop = je
    factor = -1
    boundary = &#x27;e_a cp_cm&#x27;
  []
  [positive_mass]
    type = MaterialInterfaceNeumannBC
    variable = c
    neighbor_var = c
    prop = je
    factor = 1
    boundary = &#x27;a_e cm_cp&#x27;
  []
  [heat]
    type = MaterialInterfaceNeumannBC
    variable = T
    neighbor_var = T
    prop = he
    factor = 1
    boundary = &#x27;a_e cm_cp e_a cp_cm&#x27;
  []
  [continuity_c]
    type = InterfaceContinuity
    variable = c
    neighbor_var = c
    penalty = ${c_penalty}
    boundary = &#x27;cm_e&#x27;
  []
  [continuity_Phi_ca]
    type = InterfaceContinuity
    variable = Phi_ca
    neighbor_var = Phi
    penalty = ${Phi_penalty}
    boundary = &#x27;cm_cp&#x27;
  []
  [continuity_Phi]
    type = InterfaceContinuity
    variable = Phi
    neighbor_var = Phi
    penalty = ${Phi_penalty}
    boundary = &#x27;cm_e&#x27;
  []
  [continuity_disp_x]
    type = InterfaceContinuity
    variable = disp_x
    neighbor_var = disp_x
    penalty = ${u_penalty}
    boundary = &#x27;cp_cm cm_e e_a&#x27;
  []
  [continuity_disp_y]
    type = InterfaceContinuity
    variable = disp_y
    neighbor_var = disp_y
    penalty = ${u_penalty}
    boundary = &#x27;cp_cm cm_e e_a&#x27;
  []
  [continuity_T]
    type = InterfaceContinuity
    variable = T
    neighbor_var = T
    penalty = ${T_penalty}
    boundary = &#x27;cp_cm cm_e e_a&#x27;
  []
[]

[Functions]
  [in]
    type = PiecewiseLinear
    x = &#x27;0 ${t0}&#x27;
    y = &#x27;0 ${in}&#x27;
  []
[]

[BCs]
  [current]
    type = CoupledVarDirichletBC
    variable = Phi
    boundary = right
    value = Phi0
  []
  [potential]
    type = DirichletBC
    variable = Phi_ca
    boundary = left
    value = 0
  []
  [fix_x]
    type = DirichletBC
    variable = disp_x
    value = 0
    boundary = &#x27;left right&#x27;
  []
  [fix_y]
    type = DirichletBC
    variable = disp_y
    value = 0
    boundary = &#x27;bottom&#x27;
  []
  [hconv]
    type = ADMatNeumannBC
    variable = T
    boundary = &#x27;left right&#x27;
    value = -1
    boundary_material = qconv
  []
[]

[Constraints]
  [ev_y]
    type = EqualValueBoundaryConstraint
    variable = disp_y
    penalty = ${u_penalty}
    secondary = top
  []
[]

[Materials]
  # Electrodynamics
  [conductivity]
    type = ADPiecewiseConstantByBlockMaterial
    prop_name = &#x27;sigma&#x27;
    subdomain_to_prop_value = &#x27;a ${sigma_a} e ${sigma_e} cm ${sigma_cm} cp ${sigma_cp}&#x27;
  []
  [conductivity_ca]
    type = ADPiecewiseConstantByBlockMaterial
    prop_name = &#x27;sigma_ca&#x27;
    subdomain_to_prop_value = &#x27;cm ${sigma_ca}&#x27;
    block = cm
  []
  [charge_transport]
    type = BulkChargeTransport
    electrical_energy_density = q
    electric_potential = Phi
    electric_conductivity = sigma
    temperature = T
  []
  [charge_transport_ca]
    type = BulkChargeTransport
    electrical_energy_density = q_ca
    electric_potential = Phi_ca
    electric_conductivity = sigma_ca
    temperature = T
    block = cm
  []
  [current_density]
    type = CurrentDensity
    current_density = i
    electric_potential = Phi
    output_properties = i
    outputs = exodus
  []
  [current_density_ca]
    type = CurrentDensity
    current_density = i_ca
    electric_potential = Phi_ca
    output_properties = i_ca
    outputs = exodus
    block = cm
  []

  # Chemical reactions
  [diffusivity]
    type = ADPiecewiseConstantByBlockMaterial
    prop_name = &#x27;D&#x27;
    subdomain_to_prop_value = &#x27;a ${D_a} e ${D_e} cm ${D_cm} cp ${D_cp}&#x27;
  []
  [mobility]
    type = ADParsedMaterial
    f_name = M
    args = &#x27;c_ref T_ref&#x27;
    material_property_names = &#x27;D&#x27;
    function = &#x27;D*c_ref/${R}/T_ref&#x27;
  []
  [chemical_energy]
    type = EntropicChemicalEnergyDensity
    chemical_energy_density = psi_c
    concentration = c
    ideal_gas_constant = ${R}
    temperature = T_ref
    reference_concentration = ${c_ref_entropy}
  []
  [chemical_potential]
    type = ChemicalPotential
    chemical_potential = mu
    concentration = c
    energy_densities = &#x27;dot(psi_m) dot(psi_c) chi q q_ca zeta m&#x27;
  []
  [diffusion]
    type = MassDiffusion
    dual_chemical_energy_density = zeta
    chemical_potential = mu
    mobility = M
  []
  [mass_flux]
    type = MassFlux
    mass_flux = j
    chemical_potential = mu
    outputs = exodus
  []

  # Redox
  [ramp]
    type = ADGenericFunctionMaterial
    prop_names = &#x27;ramp&#x27;
    prop_values = &#x27;if(t&lt;${t0},t/${t0},1)&#x27;
  []
  [OCP_anode_graphite]
    type = ADParsedMaterial
    f_name = U
    function = &#x27;x:=c/${cmax_a}; 2.77e-4*x^2-0.0069*x+0.0785&#x27;
    # function = &#x27;x:=c/${cmax_a}; -(122.12*x^6-321.81*x^5+315.59*x^4-141.26*x^3+28.218*x^2-1.9057*x+0.0785)*ramp&#x27;
    args = c
    material_property_names = &#x27;ramp&#x27;
    block = &#x27;a&#x27;
  []
  [OCP_cathode_NMC111]
    type = ADParsedMaterial
    f_name = U
    function = &#x27;x:=c/${cmax_c}; (6.0826-6.9922*x+7.1062*x^2-5.4549e-5*exp(124.23*x-114.2593)-2.5947*x^3)*ramp&#x27;
    args = c
    material_property_names = &#x27;ramp&#x27;
    block = &#x27;cp&#x27;
  []
  [charge_transfer_anode_elyte]
    type = ChargeTransferReaction
    electrode = true
    charge_transfer_current_density = ie
    charge_transfer_mass_flux = je
    charge_transfer_heat_flux = he
    electric_potential = Phi
    neighbor_electric_potential = Phi
    charge_transfer_coefficient = 0.5
    exchange_current_density = ${i0_a}
    faraday_constant = ${F}
    ideal_gas_constant = ${R}
    temperature = T
    open_circuit_potential = U
    boundary = &#x27;a_e&#x27;
  []
  [charge_transfer_elyte_anode]
    type = ChargeTransferReaction
    electrode = false
    charge_transfer_current_density = ie
    charge_transfer_mass_flux = je
    charge_transfer_heat_flux = he
    electric_potential = Phi
    neighbor_electric_potential = Phi
    charge_transfer_coefficient = 0.5
    exchange_current_density = ${i0_a}
    faraday_constant = ${F}
    ideal_gas_constant = ${R}
    temperature = T
    open_circuit_potential = U
    boundary = &#x27;e_a&#x27;
  []
  [charge_transfer_cathode_elyte]
    type = ChargeTransferReaction
    electrode = true
    charge_transfer_current_density = ie
    charge_transfer_mass_flux = je
    charge_transfer_heat_flux = he
    electric_potential = Phi
    neighbor_electric_potential = Phi
    charge_transfer_coefficient = 0.5
    exchange_current_density = ${i0_c}
    faraday_constant = ${F}
    ideal_gas_constant = ${R}
    temperature = T
    open_circuit_potential = U
    boundary = &#x27;cp_cm&#x27;
  []
  [charge_transfer_elyte_cathode]
    type = ChargeTransferReaction
    electrode = false
    charge_transfer_current_density = ie
    charge_transfer_mass_flux = je
    charge_transfer_heat_flux = he
    electric_potential = Phi
    neighbor_electric_potential = Phi
    charge_transfer_coefficient = 0.5
    exchange_current_density = ${i0_c}
    faraday_constant = ${F}
    ideal_gas_constant = ${R}
    temperature = T
    open_circuit_potential = U
    boundary = &#x27;cm_cp&#x27;
  []

  # Thermal
  [thermal_properties]
    type = ADGenericConstantMaterial
    prop_names = &#x27;rho cv kappa&#x27;
    prop_values = &#x27;${rho} ${cv} ${kappa}&#x27;
  []
  [heat_conduction]
    type = FourierPotential
    thermal_energy_density = chi
    thermal_conductivity = kappa
    temperature = T
  []
  [heat_flux]
    type = HeatFlux
    heat_flux = h
    temperature = T
    output_properties = h
    outputs = exodus
  []
  [heat_source]
    type = VariationalHeatSource
    heat_source = r
    temperature = T
    output_properties = r
    outputs = exodus
  []
  [conv]
    type = ADParsedMaterial
    f_name = qconv
    function = &#x27;${htc}*(T-T_ref)&#x27;
    args = &#x27;T T_ref&#x27;
    boundary = &#x27;left right&#x27;
  []

  # Mechanical
  [stiffness_cp]
    type = ADGenericConstantMaterial
    prop_names = &#x27;lambda G&#x27;
    prop_values = &#x27;${fparse E_cp*nu_cp/(1+nu_cp)/(1-2*nu_cp)} ${fparse E_cp/2/(1+nu_cp)}&#x27;
    block = cp
  []
  [stiffness_cm]
    type = ADGenericConstantMaterial
    prop_names = &#x27;lambda G&#x27;
    prop_values = &#x27;${fparse E_cm*nu_cm/(1+nu_cm)/(1-2*nu_cm)} ${fparse E_cm/2/(1+nu_cm)}&#x27;
    block = cm
  []
  [stiffness_e]
    type = ADGenericConstantMaterial
    prop_names = &#x27;lambda G&#x27;
    prop_values = &#x27;${fparse E_e*nu_e/(1+nu_e)/(1-2*nu_e)} ${fparse E_e/2/(1+nu_e)}&#x27;
    block = e
  []
  [stiffness_a]
    type = ADGenericConstantMaterial
    prop_names = &#x27;lambda G&#x27;
    prop_values = &#x27;${fparse E_a*nu_a/(1+nu_a)/(1-2*nu_a)} ${fparse E_a/2/(1+nu_a)}&#x27;
    block = a
  []
  [swelling_coefficient]
    type = ADGenericConstantMaterial
    prop_names = &#x27;beta&#x27;
    prop_values = &#x27;${beta}&#x27;
  []
  [swelling]
    type = SwellingDeformationGradient
    concentration = c
    reference_concentration = c_ref
    molar_volume = ${Omega}
    swelling_coefficient = beta
  []
  [thermal_expansion]
    type = ThermalDeformationGradient
    temperature = T
    reference_temperature = T_ref
    CTE = ${CTE}
  []
  [defgrad]
    type = MechanicalDeformationGradient
  []
  [neohookean]
    type = NeoHookeanSolid
    elastic_energy_density = psi_m
    lambda = lambda
    shear_modulus = G
    concentration = c
    temperature = T
    non_swelling_pressure = p
    output_properties = &#x27;p&#x27;
    outputs = exodus
  []
  [pk1]
    type = FirstPiolaKirchhoffStress
    first_piola_kirchhoff_stress = pk1
    deformation_gradient_rate = dot(F)
  []
[]

[Postprocessors]
  [V_l]
    type = SideAverageValue
    variable = Phi_ca
    boundary = left
    outputs = none
    execute_on = &#x27;INITIAL TIMESTEP_END&#x27;
  []
  [V_r]
    type = SideAverageValue
    variable = Phi
    boundary = right
    outputs = none
    execute_on = &#x27;INITIAL TIMESTEP_END&#x27;
  []
  [V]
    type = ParsedPostprocessor
    function = &#x27;V_l - V_r&#x27;
    pp_names = &#x27;V_l V_r&#x27;
    execute_on = &#x27;INITIAL TIMESTEP_END&#x27;
  []
  [I]
    type = ADSideIntegralMaterialProperty
    property = i
    component = 0
    boundary = right
    execute_on = &#x27;INITIAL TIMESTEP_END&#x27;
  []
  [dt]
    type = TimestepSize
    outputs = none
    execute_on = &#x27;INITIAL TIMESTEP_END&#x27;
  []
  [dC]
    type = ParsedPostprocessor
    function = &#x27;dt*I&#x27;
    pp_names = &#x27;dt I&#x27;
    outputs = none
    execute_on = &#x27;INITIAL TIMESTEP_END&#x27;
  []
  [C]
    type = CumulativeValuePostprocessor
    postprocessor = dC
    execute_on = &#x27;INITIAL TIMESTEP_END&#x27;
  []
[]

[UserObjects]
  [kill_V]
    type = Terminator
    expression = &#x27;I &lt;= 1e-6&#x27;
  []
[]

[Executioner]
  type = Transient
  solve_type = NEWTON

  petsc_options = &#x27;-ksp_converged_reason&#x27;
  # petsc_options_iname = &#x27;-pc_type -pc_hypre_type -ksp_gmres_restart -pc_hypre_boomeramg_strong_threshold -pc_hypre_boomeramg_interp_type -pc_hypre_boomeramg_coarsen_type -pc_hypre_boomeramg_agg_nl -pc_hypre_boomeramg_agg_num_paths -pc_hypre_boomeramg_truncfactor&#x27;
  # petsc_options_value = &#x27;hypre boomeramg 301 0.25 ext+i PMIS 4 2 0.4&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;
  automatic_scaling = true
  ignore_variables_for_autoscaling = &#x27;T&#x27;
  verbose = true
  line_search = none

  l_max_its = 300
  l_tol = 1e-6
  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-9
  nl_max_its = 12

  [Predictor]
    type = SimplePredictor
    scale = 1
  []
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = &#x27;${fparse t0/50}&#x27;
    optimal_iterations = 6
    iteration_window = 1
    growth_factor = 1.2
    cutback_factor = 0.2
    cutback_factor_at_failure = 0.1
    linear_iteration_ratio = 100
  []
  end_time = 10000
[]

[Outputs]
  exodus = true
  csv = true
  print_linear_residuals = false
  checkpoint = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="cfe65e05-3170-421d-9665-6fa1c49c21d7"><div class="modal-content"><h4>(examples/degradation/CV_charging.i)</h4><pre class="moose-pre"><code class="language-text">[Problem]
  restart_file_base = &#x27;T_${T0}/cycle_${cycle}_CC_charging_I_${I}_cp/LATEST&#x27;
[]

[BCs]
  [Phi]
    type = CoupledVarDirichletBC
    variable = Phi
    boundary = &#x27;left right&#x27;
    value = Phi0
  []
[]

[Materials]
  [ramp]
    type = ADGenericFunctionMaterial
    prop_names = &#x27;ramp&#x27;
    prop_values = &#x27;1&#x27;
  []
[]

[UserObjects]
  [kill_i]
    type = Terminator
    expression = &#x27;-I &lt;= 1e-4&#x27;
    message = &#x27;No current.&#x27;
  []
[]

[Executioner]
  type = Transient
  solve_type = NEWTON

  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;
  automatic_scaling = true
  line_search = none

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-10
  nl_max_its = 20

  [Predictor]
    type = SimplePredictor
    scale = 1
    skip_after_failed_timestep = true
  []
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = ${dt}
    optimal_iterations = 7
    iteration_window = 2
    growth_factor = 1.2
    cutback_factor = 0.5
    cutback_factor_at_failure = 0.2
    linear_iteration_ratio = 1000000
  []
  dtmax = ${t0}
  start_time = 0
  end_time = 100000
[]

[Outputs]
  file_base = &#x27;T_${T0}/cycle_${cycle}_CV_charging_I_${I}&#x27;
  csv = true
  print_linear_residuals = false
  checkpoint = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="875cea40-95a1-4658-a8a3-7bff86b28c6d"><div class="modal-content"><h4>(examples/SSB_3D/CV_charging.i)</h4><pre class="moose-pre"><code class="language-text">I = 0.005 #mA
width = 0.05 #mm
in = &#x27;${fparse -I/width/width}&#x27;
t0 = &#x27;${fparse -1e-2/in}&#x27;

sigma_a = 0.2 #mS/mm
sigma_e = 0.1 #mS/mm
sigma_cp = 0.05 #mS/mm
sigma_ca = 0.2 #mS/mm
sigma_cm = 0.05 #mS/mm

Phi_penalty = 10

cmin_a = 1e-4 #mmol/mm^3
cmax_a = 1e-3 #mmol/mm^3
c_e = 5e-4 #mmol/mm^3
cmax_c = 1e-3 #mmol/mm^3
c_ref_entropy = 5e-5
D_cp = 5e-5 #mm^2/s
D_cm = 1e-4 #mm^2/s
D_a = 5e-4 #mm^2/s
D_e = 1e-4 #mm^2/s

c_penalty = 1

R = 8.3145 #mJ/mmol/K
T0 = 300 #K
F = 96485 #mC/mmol

i0_a = 1e-1 #mA/mm^2
i0_c = 1e-1 #mA/mm^2

E_cp = 6e4
E_cm = 5e4
E_e = 5e4
E_a = 1e5
nu_cp = 0.3
nu_cm = 0.25
nu_e = 0.25
nu_a = 0.3

u_penalty = 1e8

Omega = 140
beta = 1e-4
CTE = 1e-5

rho = 2.5e-9 #Mg/mm^3
cv = 2.7e8 #mJ/Mg/K
kappa = 2e-4 #mJ/mm/K/s
htc = 9.5e-3

T_penalty = 1

[GlobalParams]
  energy_densities = &#x27;dot(psi_m) dot(psi_c) chi q q_ca zeta&#x27;
  deformation_gradient = F
  mechanical_deformation_gradient = Fm
  eigen_deformation_gradient = Fg
  swelling_deformation_gradient = Fs
  thermal_deformation_gradient = Ft
  displacements = &#x27;disp_x disp_y disp_z&#x27;
[]

[Problem]
  restart_file_base = &#x27;${outname}_CC_charging_cp/LATEST&#x27;
[]

[Mesh]
  [battery]
    type = FileMeshGenerator
    file = &#x27;../coarse.e&#x27;
  []
  [scale]
    type = TransformGenerator
    input = battery
    transform = SCALE
    vector_value = &#x27;1e-3 1e-3 1e-3&#x27; #um to mm
  []
  [cathode_particle]
    type = RenameBlockGenerator
    input = scale
    old_block = &#x27;1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44&#x27;
    new_block = &#x27;cp cp cp cp cp cp cp cp cp cp cp cp cp cp cp cp cp cp cp cp cp cp cp cp cp cp cp cp cp cp cp cp cp cp cp cp cp cp cp cp cp cp cp cp&#x27;
  []
  [cathode_matrix]
    type = RenameBlockGenerator
    input = cathode_particle
    old_block = &#x27;48&#x27;
    new_block = &#x27;cm&#x27;
  []
  [elyte]
    type = RenameBlockGenerator
    input = cathode_matrix
    old_block = 49
    new_block = &#x27;e&#x27;
  []
  [anode]
    type = RenameBlockGenerator
    input = elyte
    old_block = 50
    new_block = &#x27;a&#x27;
  []
  [interfaces]
    type = BreakMeshByBlockGenerator
    input = anode
    add_interface_on_two_sides = true
    split_interface = true
  []
  [sidesets]
    type = SideSetsFromNormalsGenerator
    input = interfaces
    normals = &#x27;-1 0 0 1 0 0 0 -1 0 0 1 0 0 0 -1 0 0 1&#x27;
    new_boundary = &#x27;left right bottom top back front&#x27;
  []
  use_displaced_mesh = false
[]

[Variables]
  [Phi_ca]
    block = cm
  []
  [Phi]
  []
  [c]
  []
  [disp_x]
  []
  [disp_y]
  []
  [disp_z]
  []
  [T]
  []
[]

[AuxVariables]
  [c_ref]
  []
  [T_ref]
    initial_condition = ${T0}
  []
  [stress]
    order = CONSTANT
    family = MONOMIAL
    [AuxKernel]
      type = ADRankTwoScalarAux
      rank_two_tensor = pk1
      scalar_type = Hydrostatic
      execute_on = &#x27;INITIAL TIMESTEP_END&#x27;
    []
  []
  [Js]
    order = CONSTANT
    family = MONOMIAL
    [AuxKernel]
      type = ADRankTwoScalarAux
      rank_two_tensor = Fs
      scalar_type = ThirdInvariant
      execute_on = &#x27;INITIAL TIMESTEP_END&#x27;
    []
  []
  [Jt]
    order = CONSTANT
    family = MONOMIAL
    [AuxKernel]
      type = ADRankTwoScalarAux
      rank_two_tensor = Ft
      scalar_type = ThirdInvariant
      execute_on = &#x27;INITIAL TIMESTEP_END&#x27;
    []
  []
  [Phi0]
    [AuxKernel]
      type = ParsedAux
      function = &#x27;Phi&#x27;
      args = &#x27;Phi&#x27;
      execute_on = &#x27;INITIAL&#x27;
    []
  []
[]

[ICs]
  [c_ref_a]
    type = ConstantIC
    variable = c_ref
    value = ${cmin_a}
    block = &#x27;a&#x27;
  []
  [c_ref_e]
    type = ConstantIC
    variable = c_ref
    value = ${c_e}
    block = &#x27;cm e&#x27;
  []
  [c_ref_c]
    type = ConstantIC
    variable = c_ref
    value = ${cmax_c}
    block = &#x27;cp&#x27;
  []
[]

[Kernels]
  # Charge balance
  [charge_balance]
    type = RankOneDivergence
    variable = Phi
    vector = i
  []
  [charge_balance_ca]
    type = RankOneDivergence
    variable = Phi_ca
    vector = i_ca
    block = cm
  []
  # Mass balance
  [mass_balance_1]
    type = TimeDerivative
    variable = c
  []
  [mass_balance_2]
    type = RankOneDivergence
    variable = c
    vector = j
  []
  # Momentum balance
  [momentum_balance_x]
    type = RankTwoDivergence
    variable = disp_x
    component = 0
    tensor = pk1
    factor = -1
  []
  [momentum_balance_y]
    type = RankTwoDivergence
    variable = disp_y
    component = 1
    tensor = pk1
    factor = -1
  []
  [momentum_balance_z]
    type = RankTwoDivergence
    variable = disp_z
    component = 2
    tensor = pk1
    factor = -1
  []
  # Energy balance
  [energy_balance_1]
    type = EnergyBalanceTimeDerivative
    variable = T
    density = rho
    specific_heat = cv
  []
  [energy_balance_2]
    type = RankOneDivergence
    variable = T
    vector = h
  []
  [heat_source]
    type = MaterialSource
    variable = T
    prop = r
    coefficient = -1
  []
[]

[InterfaceKernels]
  [negative_current]
    type = MaterialInterfaceNeumannBC
    variable = Phi
    neighbor_var = Phi
    prop = ie
    factor = -1
    boundary = &#x27;e_a cp_cm&#x27;
  []
  [positive_current]
    type = MaterialInterfaceNeumannBC
    variable = Phi
    neighbor_var = Phi
    prop = ie
    boundary = &#x27;a_e cm_cp&#x27;
  []
  [negative_mass]
    type = MaterialInterfaceNeumannBC
    variable = c
    neighbor_var = c
    prop = je
    factor = -1
    boundary = &#x27;e_a cp_cm&#x27;
  []
  [positive_mass]
    type = MaterialInterfaceNeumannBC
    variable = c
    neighbor_var = c
    prop = je
    factor = 1
    boundary = &#x27;a_e cm_cp&#x27;
  []
  [heat]
    type = MaterialInterfaceNeumannBC
    variable = T
    neighbor_var = T
    prop = he
    factor = 1
    boundary = &#x27;a_e cm_cp e_a cp_cm&#x27;
  []
  [continuity_c]
    type = InterfaceContinuity
    variable = c
    neighbor_var = c
    penalty = ${c_penalty}
    boundary = &#x27;cm_e&#x27;
  []
  [continuity_Phi_ca]
    type = InterfaceContinuity
    variable = Phi_ca
    neighbor_var = Phi
    penalty = ${Phi_penalty}
    boundary = &#x27;cm_cp&#x27;
  []
  [continuity_Phi]
    type = InterfaceContinuity
    variable = Phi
    neighbor_var = Phi
    penalty = ${Phi_penalty}
    boundary = &#x27;cm_e&#x27;
  []
  [continuity_disp_x]
    type = InterfaceContinuity
    variable = disp_x
    neighbor_var = disp_x
    penalty = ${u_penalty}
    boundary = &#x27;cp_cm cm_e e_a&#x27;
  []
  [continuity_disp_y]
    type = InterfaceContinuity
    variable = disp_y
    neighbor_var = disp_y
    penalty = ${u_penalty}
    boundary = &#x27;cp_cm cm_e e_a&#x27;
  []
  [continuity_disp_z]
    type = InterfaceContinuity
    variable = disp_z
    neighbor_var = disp_z
    penalty = ${u_penalty}
    boundary = &#x27;cp_cm cm_e e_a&#x27;
  []
  [continuity_T]
    type = InterfaceContinuity
    variable = T
    neighbor_var = T
    penalty = ${T_penalty}
    boundary = &#x27;cp_cm cm_e e_a&#x27;
  []
[]

[Functions]
  [in]
    type = PiecewiseLinear
    x = &#x27;0 ${t0}&#x27;
    y = &#x27;0 ${in}&#x27;
  []
[]

[BCs]
  [current]
    type = CoupledVarDirichletBC
    variable = Phi
    boundary = right
    value = Phi0
  []
  [potential]
    type = DirichletBC
    variable = Phi_ca
    boundary = left
    value = 0
  []
  [fix_x]
    type = DirichletBC
    variable = disp_x
    value = 0
    boundary = &#x27;left right&#x27;
  []
  [fix_y]
    type = DirichletBC
    variable = disp_y
    value = 0
    boundary = &#x27;bottom&#x27;
  []
  [fix_z]
    type = DirichletBC
    variable = disp_z
    value = 0
    boundary = &#x27;back&#x27;
  []
  [hconv]
    type = ADMatNeumannBC
    variable = T
    boundary = &#x27;left right&#x27;
    value = -1
    boundary_material = qconv
  []
[]

[Constraints]
  [ev_y]
    type = EqualValueBoundaryConstraint
    variable = disp_y
    penalty = ${u_penalty}
    secondary = top
  []
  [ev_z]
    type = EqualValueBoundaryConstraint
    variable = disp_z
    penalty = ${u_penalty}
    secondary = front
  []
[]

[Materials]
  # Electrodynamics
  [conductivity]
    type = ADPiecewiseConstantByBlockMaterial
    prop_name = &#x27;sigma&#x27;
    subdomain_to_prop_value = &#x27;a ${sigma_a} e ${sigma_e} cm ${sigma_cm} cp ${sigma_cp}&#x27;
  []
  [conductivity_ca]
    type = ADPiecewiseConstantByBlockMaterial
    prop_name = &#x27;sigma_ca&#x27;
    subdomain_to_prop_value = &#x27;cm ${sigma_ca}&#x27;
    block = cm
  []
  [charge_transport]
    type = BulkChargeTransport
    electrical_energy_density = q
    electric_potential = Phi
    electric_conductivity = sigma
    temperature = T
  []
  [charge_transport_ca]
    type = BulkChargeTransport
    electrical_energy_density = q_ca
    electric_potential = Phi_ca
    electric_conductivity = sigma_ca
    temperature = T
    block = cm
  []
  [current_density]
    type = CurrentDensity
    current_density = i
    electric_potential = Phi
    output_properties = i
    outputs = exodus
  []
  [current_density_ca]
    type = CurrentDensity
    current_density = i_ca
    electric_potential = Phi_ca
    output_properties = i_ca
    outputs = exodus
    block = cm
  []

  # Chemical reactions
  [diffusivity]
    type = ADPiecewiseConstantByBlockMaterial
    prop_name = &#x27;D&#x27;
    subdomain_to_prop_value = &#x27;a ${D_a} e ${D_e} cm ${D_cm} cp ${D_cp}&#x27;
  []
  [mobility]
    type = ADParsedMaterial
    f_name = M
    args = &#x27;c_ref T_ref&#x27;
    material_property_names = &#x27;D&#x27;
    function = &#x27;D*c_ref/${R}/T_ref&#x27;
  []
  [chemical_energy]
    type = EntropicChemicalEnergyDensity
    chemical_energy_density = psi_c
    concentration = c
    ideal_gas_constant = ${R}
    temperature = T_ref
    reference_concentration = ${c_ref_entropy}
  []
  [chemical_potential]
    type = ChemicalPotential
    chemical_potential = mu
    concentration = c
    energy_densities = &#x27;dot(psi_m) dot(psi_c) chi q q_ca zeta m&#x27;
  []
  [diffusion]
    type = MassDiffusion
    dual_chemical_energy_density = zeta
    chemical_potential = mu
    mobility = M
  []
  [mass_flux]
    type = MassFlux
    mass_flux = j
    chemical_potential = mu
    outputs = exodus
  []

  # Redox
  [ramp]
    type = ADGenericFunctionMaterial
    prop_names = &#x27;ramp&#x27;
    prop_values = &#x27;if(t&lt;${t0},t/${t0},1)&#x27;
  []
  [OCP_anode_graphite]
    type = ADParsedMaterial
    f_name = U
    function = &#x27;x:=c/${cmax_a}; 2.77e-4*x^2-0.0069*x+0.0785&#x27;
    # function = &#x27;x:=c/${cmax_a}; -(122.12*x^6-321.81*x^5+315.59*x^4-141.26*x^3+28.218*x^2-1.9057*x+0.0785)*ramp&#x27;
    args = c
    material_property_names = &#x27;ramp&#x27;
    block = &#x27;a&#x27;
  []
  [OCP_cathode_NMC111]
    type = ADParsedMaterial
    f_name = U
    function = &#x27;x:=c/${cmax_c}; (6.0826-6.9922*x+7.1062*x^2-5.4549e-5*exp(124.23*x-114.2593)-2.5947*x^3)*ramp&#x27;
    args = c
    material_property_names = &#x27;ramp&#x27;
    block = &#x27;cp&#x27;
  []
  [charge_transfer_anode_elyte]
    type = ChargeTransferReaction
    electrode = true
    charge_transfer_current_density = ie
    charge_transfer_mass_flux = je
    charge_transfer_heat_flux = he
    electric_potential = Phi
    neighbor_electric_potential = Phi
    charge_transfer_coefficient = 0.5
    exchange_current_density = ${i0_a}
    faraday_constant = ${F}
    ideal_gas_constant = ${R}
    temperature = T
    open_circuit_potential = U
    boundary = &#x27;a_e&#x27;
  []
  [charge_transfer_elyte_anode]
    type = ChargeTransferReaction
    electrode = false
    charge_transfer_current_density = ie
    charge_transfer_mass_flux = je
    charge_transfer_heat_flux = he
    electric_potential = Phi
    neighbor_electric_potential = Phi
    charge_transfer_coefficient = 0.5
    exchange_current_density = ${i0_a}
    faraday_constant = ${F}
    ideal_gas_constant = ${R}
    temperature = T
    open_circuit_potential = U
    boundary = &#x27;e_a&#x27;
  []
  [charge_transfer_cathode_elyte]
    type = ChargeTransferReaction
    electrode = true
    charge_transfer_current_density = ie
    charge_transfer_mass_flux = je
    charge_transfer_heat_flux = he
    electric_potential = Phi
    neighbor_electric_potential = Phi
    charge_transfer_coefficient = 0.5
    exchange_current_density = ${i0_c}
    faraday_constant = ${F}
    ideal_gas_constant = ${R}
    temperature = T
    open_circuit_potential = U
    boundary = &#x27;cp_cm&#x27;
  []
  [charge_transfer_elyte_cathode]
    type = ChargeTransferReaction
    electrode = false
    charge_transfer_current_density = ie
    charge_transfer_mass_flux = je
    charge_transfer_heat_flux = he
    electric_potential = Phi
    neighbor_electric_potential = Phi
    charge_transfer_coefficient = 0.5
    exchange_current_density = ${i0_c}
    faraday_constant = ${F}
    ideal_gas_constant = ${R}
    temperature = T
    open_circuit_potential = U
    boundary = &#x27;cm_cp&#x27;
  []

  # Thermal
  [thermal_properties]
    type = ADGenericConstantMaterial
    prop_names = &#x27;rho cv kappa&#x27;
    prop_values = &#x27;${rho} ${cv} ${kappa}&#x27;
  []
  [heat_conduction]
    type = FourierPotential
    thermal_energy_density = chi
    thermal_conductivity = kappa
    temperature = T
  []
  [heat_flux]
    type = HeatFlux
    heat_flux = h
    temperature = T
    output_properties = h
    outputs = exodus
  []
  [heat_source]
    type = VariationalHeatSource
    heat_source = r
    temperature = T
    output_properties = r
    outputs = exodus
  []
  [conv]
    type = ADParsedMaterial
    f_name = qconv
    function = &#x27;${htc}*(T-T_ref)&#x27;
    args = &#x27;T T_ref&#x27;
    boundary = &#x27;left right&#x27;
  []

  # Mechanical
  [stiffness_cp]
    type = ADGenericConstantMaterial
    prop_names = &#x27;lambda G&#x27;
    prop_values = &#x27;${fparse E_cp*nu_cp/(1+nu_cp)/(1-2*nu_cp)} ${fparse E_cp/2/(1+nu_cp)}&#x27;
    block = cp
  []
  [stiffness_cm]
    type = ADGenericConstantMaterial
    prop_names = &#x27;lambda G&#x27;
    prop_values = &#x27;${fparse E_cm*nu_cm/(1+nu_cm)/(1-2*nu_cm)} ${fparse E_cm/2/(1+nu_cm)}&#x27;
    block = cm
  []
  [stiffness_e]
    type = ADGenericConstantMaterial
    prop_names = &#x27;lambda G&#x27;
    prop_values = &#x27;${fparse E_e*nu_e/(1+nu_e)/(1-2*nu_e)} ${fparse E_e/2/(1+nu_e)}&#x27;
    block = e
  []
  [stiffness_a]
    type = ADGenericConstantMaterial
    prop_names = &#x27;lambda G&#x27;
    prop_values = &#x27;${fparse E_a*nu_a/(1+nu_a)/(1-2*nu_a)} ${fparse E_a/2/(1+nu_a)}&#x27;
    block = a
  []
  [swelling_coefficient]
    type = ADGenericConstantMaterial
    prop_names = &#x27;beta&#x27;
    prop_values = &#x27;${beta}&#x27;
  []
  [swelling]
    type = SwellingDeformationGradient
    concentration = c
    reference_concentration = c_ref
    molar_volume = ${Omega}
    swelling_coefficient = beta
  []
  [thermal_expansion]
    type = ThermalDeformationGradient
    temperature = T
    reference_temperature = T_ref
    CTE = ${CTE}
  []
  [defgrad]
    type = MechanicalDeformationGradient
  []
  [neohookean]
    type = NeoHookeanSolid
    elastic_energy_density = psi_m
    lambda = lambda
    shear_modulus = G
    concentration = c
    temperature = T
    non_swelling_pressure = p
    output_properties = &#x27;p&#x27;
    outputs = exodus
  []
  [pk1]
    type = FirstPiolaKirchhoffStress
    first_piola_kirchhoff_stress = pk1
    deformation_gradient_rate = dot(F)
  []
[]

[Postprocessors]
  [V_l]
    type = SideAverageValue
    variable = Phi_ca
    boundary = left
    outputs = none
    execute_on = &#x27;INITIAL TIMESTEP_END&#x27;
  []
  [V_r]
    type = SideAverageValue
    variable = Phi
    boundary = right
    outputs = none
    execute_on = &#x27;INITIAL TIMESTEP_END&#x27;
  []
  [V]
    type = ParsedPostprocessor
    function = &#x27;V_l - V_r&#x27;
    pp_names = &#x27;V_l V_r&#x27;
    execute_on = &#x27;INITIAL TIMESTEP_END&#x27;
  []
  [I]
    type = ADSideIntegralMaterialProperty
    property = i
    component = 0
    boundary = right
    execute_on = &#x27;INITIAL TIMESTEP_END&#x27;
  []
  [dt]
    type = TimestepSize
    outputs = none
    execute_on = &#x27;INITIAL TIMESTEP_END&#x27;
  []
  [dC]
    type = ParsedPostprocessor
    function = &#x27;dt*I&#x27;
    pp_names = &#x27;dt I&#x27;
    outputs = none
    execute_on = &#x27;INITIAL TIMESTEP_END&#x27;
  []
  [C]
    type = CumulativeValuePostprocessor
    postprocessor = dC
    execute_on = &#x27;INITIAL TIMESTEP_END&#x27;
  []
[]

[UserObjects]
  [kill_V]
    type = Terminator
    expression = &#x27;I &lt;= 1e-6&#x27;
  []
[]

[Executioner]
  type = Transient
  solve_type = NEWTON

  petsc_options = &#x27;-ksp_converged_reason&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_hypre_type -ksp_gmres_restart -pc_hypre_boomeramg_strong_threshold -pc_hypre_boomeramg_interp_type -pc_hypre_boomeramg_coarsen_type -pc_hypre_boomeramg_agg_nl -pc_hypre_boomeramg_agg_num_paths -pc_hypre_boomeramg_truncfactor&#x27;
  petsc_options_value = &#x27;hypre boomeramg 301 0.25 ext+i PMIS 4 2 0.4&#x27;
  automatic_scaling = true
  ignore_variables_for_autoscaling = &#x27;T&#x27;
  verbose = true
  line_search = none

  l_max_its = 300
  l_tol = 1e-6
  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-9
  nl_max_its = 12

  [Predictor]
    type = SimplePredictor
    scale = 1
  []
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = &#x27;${fparse t0/50}&#x27;
    optimal_iterations = 6
    iteration_window = 1
    growth_factor = 1.2
    cutback_factor = 0.2
    cutback_factor_at_failure = 0.1
    linear_iteration_ratio = 100
  []
  end_time = 10000
[]

[Outputs]
  file_base = &#x27;${outname}_CV_charging&#x27;
  exodus = true
  csv = true
  print_linear_residuals = false
  checkpoint = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="c95b98e3-2bc5-4181-af55-649d6ea129d3"><div class="modal-content"><h4>(examples/degradation/CV_discharging.i)</h4><pre class="moose-pre"><code class="language-text">[Problem]
  restart_file_base = &#x27;T_${T0}/cycle_${cycle}_CC_discharging_I_${I}_cp/LATEST&#x27;
[]

[BCs]
  [Phi]
    type = CoupledVarDirichletBC
    variable = Phi
    boundary = &#x27;left right&#x27;
    value = Phi0
  []
[]

[Materials]
  [ramp]
    type = ADGenericFunctionMaterial
    prop_names = &#x27;ramp&#x27;
    prop_values = &#x27;1&#x27;
  []
[]

[UserObjects]
  [kill_i]
    type = Terminator
    expression = &#x27;I &lt;= 1e-4&#x27;
    message = &#x27;No current.&#x27;
  []
  # [kill_C]
  #   type = Terminator
  #   expression = &#x27;C &lt;= 0.04&#x27;
  #   message = &#x27;Min SoC&#x27;
  # []
[]

[Executioner]
  type = Transient
  solve_type = NEWTON

  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;
  automatic_scaling = true
  line_search = none

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-10
  nl_max_its = 20

  [Predictor]
    type = SimplePredictor
    scale = 1
    skip_after_failed_timestep = true
  []
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = ${dt}
    optimal_iterations = 7
    iteration_window = 2
    growth_factor = 1.2
    cutback_factor = 0.5
    cutback_factor_at_failure = 0.2
    linear_iteration_ratio = 1000000
  []
  start_time = 0
  end_time = 100000
[]

[Outputs]
  file_base = &#x27;T_${T0}/cycle_${cycle}_CV_discharging_I_${I}&#x27;
  csv = true
  print_linear_residuals = false
  checkpoint = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="83bcefb5-7734-434a-82c7-ef0a68d0dfac"><div class="modal-content"><h4>(examples/LiB/CV_charging.i)</h4><pre class="moose-pre"><code class="language-text">I = 3e-3 #mA
width = 0.03 #mm
in = &#x27;${fparse -I/width}&#x27;
t0 = &#x27;${fparse -1e-2/in}&#x27;
dt = &#x27;${fparse t0/100}&#x27;

sigma_a = 1e0 #mS/mm
sigma_e = 1e-1 #mS/mm
sigma_c = 1e-2 #mS/mm

l0 = 0
l1 = 0.04
l2 = 0.07
l3 = 0.12

cmin = 1e-4 #mmol/mm^3
cmax = 1e-3 #mmol/mm^3
D_a = 1e-3 #mm^2/s
D_e = 1e-4 #mm^2/s
D_c = 5e-5 #mm^2/s

R = 8.3145 #mJ/mmol/K
T0 = 300 #K
F = 96485 #mC/mmol

i0_a = 1e-1 #mA/mm^2
i0_c = 1e-1 #mA/mm^2

E_c = 1e5
E_e = 1e4
E_a = 2e5
nu_c = 0.3
nu_e = 0.25
nu_a = 0.3

u_penalty = 1e8

Omega = 60
beta = 1e-3
CTE = 1e-5

rho = 2.5e-9 #Mg/mm^3
cv = 2.7e8 #mJ/Mg/K
kappa = 2e-4 #mJ/mm/K/s

T_penalty = 2e-1

[GlobalParams]
  energy_densities = &#x27;dot(psi_m) dot(psi_c) chi q zeta m&#x27;
  deformation_gradient = F
  mechanical_deformation_gradient = Fm
  eigen_deformation_gradient = Fg
  swelling_deformation_gradient = Fs
  thermal_deformation_gradient = Ft
[]

[Problem]
  restart_file_base = &#x27;CC_charging_I_${I}_cp/LATEST&#x27;
[]

[Mesh]
  [battery]
    type = GeneratedMeshGenerator
    dim = 2
    xmin = ${l0}
    xmax = ${l3}
    ymin = 0
    ymax = ${width}
    nx = 60
    ny = 15
  []
  [anode]
    type = SubdomainBoundingBoxGenerator
    input = battery
    block_id = 1
    block_name = anode
    bottom_left = &#x27;${l0} 0 0&#x27;
    top_right = &#x27;${l1} ${width} 0&#x27;
  []
  [elyte]
    type = SubdomainBoundingBoxGenerator
    input = anode
    block_id = 2
    block_name = elyte
    bottom_left = &#x27;${l1} 0 0&#x27;
    top_right = &#x27;${l2} ${width} 0&#x27;
  []
  [cathode]
    type = SubdomainBoundingBoxGenerator
    input = elyte
    block_id = 3
    block_name = cathode
    bottom_left = &#x27;${l2} 0 0&#x27;
    top_right = &#x27;${l3} ${width} 0&#x27;
  []
  [interfaces]
    type = BreakMeshByBlockGenerator
    input = cathode
    add_interface_on_two_sides = true
    split_interface = true
  []
[]

[Variables]
  [Phi]
  []
  [c]
  []
  [disp_x]
  []
  [disp_y]
  []
  [T]
  []
[]

[AuxVariables]
  [c_ref]
  []
  [T_ref]
    initial_condition = ${T0}
  []
  [Phi0]
  []
[]

[ICs]
  [c_ref_min]
    type = ConstantIC
    variable = c_ref
    value = ${cmin}
    block = &#x27;anode&#x27;
  []
  [c_ref_mid]
    type = ConstantIC
    variable = c_ref
    value = &#x27;${fparse (cmax+cmin)/2}&#x27;
    block = &#x27;elyte&#x27;
  []
  [c_ref_max]
    type = ConstantIC
    variable = c_ref
    value = ${cmax}
    block = &#x27;cathode&#x27;
  []
[]

[AuxKernels]
  [Phi0]
    type = ParsedAux
    variable = Phi0
    function = &#x27;Phi&#x27;
    args = &#x27;Phi&#x27;
    execute_on = &#x27;INITIAL&#x27;
  []
[]

[Kernels]
  # Charge balance
  [charge_balance]
    type = RankOneDivergence
    variable = Phi
    vector = i
  []
  # Mass balance
  [mass_balance_1]
    type = TimeDerivative
    variable = c
  []
  [mass_balance_2]
    type = RankOneDivergence
    variable = c
    vector = j
  []
  # Momentum balance
  [momentum_balance_x]
    type = RankTwoDivergence
    variable = disp_x
    component = 0
    tensor = pk1
    factor = -1
  []
  [momentum_balance_y]
    type = RankTwoDivergence
    variable = disp_y
    component = 1
    tensor = pk1
    factor = -1
  []
  # Energy balance
  [energy_balance_1]
    type = EnergyBalanceTimeDerivative
    variable = T
    density = rho
    specific_heat = cv
  []
  [energy_balance_2]
    type = RankOneDivergence
    variable = T
    vector = h
  []
  [heat_source]
    type = MaterialSource
    variable = T
    prop = r
    coefficient = -1
  []
[]

[InterfaceKernels]
  [negative_current]
    type = MaterialInterfaceNeumannBC
    variable = Phi
    neighbor_var = Phi
    prop = ie
    factor = -1
    boundary = &#x27;elyte_anode cathode_elyte&#x27;
  []
  [positive_current]
    type = MaterialInterfaceNeumannBC
    variable = Phi
    neighbor_var = Phi
    prop = ie
    boundary = &#x27;anode_elyte elyte_cathode&#x27;
  []
  [heat]
    type = MaterialInterfaceNeumannBC
    variable = T
    neighbor_var = T
    prop = he
    factor = 1
    boundary = &#x27;anode_elyte elyte_cathode elyte_anode cathode_elyte&#x27;
  []
  [continuity_disp_x]
    type = InterfaceContinuity
    variable = disp_x
    neighbor_var = disp_x
    penalty = ${u_penalty}
    boundary = &#x27;anode_elyte elyte_cathode&#x27;
  []
  [continuity_disp_y]
    type = InterfaceContinuity
    variable = disp_y
    neighbor_var = disp_y
    penalty = ${u_penalty}
    boundary = &#x27;anode_elyte elyte_cathode&#x27;
  []
  [continuity_T]
    type = InterfaceContinuity
    variable = T
    neighbor_var = T
    penalty = ${T_penalty}
    boundary = &#x27;anode_elyte elyte_cathode&#x27;
  []
[]

[Functions]
  [in]
    type = PiecewiseLinear
    x = &#x27;0 ${t0}&#x27;
    y = &#x27;0 ${in}&#x27;
  []
[]

[BCs]
  [Phi]
    type = CoupledVarDirichletBC
    variable = Phi
    boundary = &#x27;left right&#x27;
    value = Phi0
  []
  [fix_x]
    type = DirichletBC
    variable = disp_x
    value = 0
    boundary = &#x27;left right&#x27;
  []
  [fix_y]
    type = DirichletBC
    variable = disp_y
    value = 0
    boundary = &#x27;bottom&#x27;
  []
  [open]
    type = OpenBC
    variable = c
    flux = jm
    boundary = &#x27;left right&#x27;
  []
[]

[Constraints]
  [y]
    type = EqualValueBoundaryConstraint
    variable = disp_y
    penalty = ${u_penalty}
    secondary = top
  []
[]

[Materials]
  # Electrodynamics
  [conductivity]
    type = ADPiecewiseConstantByBlockMaterial
    prop_name = &#x27;sigma&#x27;
    subdomain_to_prop_value = &#x27;anode ${sigma_a} elyte ${sigma_e} cathode ${sigma_c}&#x27;
  []
  [charge_transport]
    type = BulkChargeTransport
    electrical_energy_density = q
    electric_potential = Phi
    electric_conductivity = sigma
    temperature = T
  []
  [current_density]
    type = CurrentDensity
    current_density = i
    electric_potential = Phi
  []

  # Chemical reactions
  [diffusivity]
    type = ADPiecewiseConstantByBlockMaterial
    prop_name = &#x27;D&#x27;
    subdomain_to_prop_value = &#x27;anode ${D_a} elyte ${D_e} cathode ${D_c}&#x27;
  []
  [mobility]
    type = ADParsedMaterial
    f_name = M
    args = &#x27;c_ref T_ref&#x27;
    material_property_names = &#x27;D&#x27;
    function = &#x27;D*c_ref/${R}/T_ref&#x27;
  []
  [chemical_energy]
    type = EntropicChemicalEnergyDensity
    chemical_energy_density = psi_c
    concentration = c
    ideal_gas_constant = ${R}
    temperature = T
    reference_concentration = c_ref
  []
  [chemical_potential]
    type = ChemicalPotential
    chemical_potential = mu
    concentration = c
  []
  [diffusion]
    type = MassDiffusion
    dual_chemical_energy_density = zeta
    chemical_potential = mu
    mobility = M
  []
  [mass_flux]
    type = MassFlux
    mass_flux = j
    chemical_potential = mu
  []

  # Migration
  [migration]
    type = Migration
    electrochemical_energy_density = m
    electric_potential = Phi
    chemical_potential = mu
    electric_conductivity = sigma
    faraday_constant = ${F}
  []
  [migration_flux]
    type = MassFlux
    mass_flux = jm
    energy_densities = &#x27;m&#x27;
    chemical_potential = mu
  []

  # Redox
  [OCP_anode_graphite]
    type = ADParsedMaterial
    f_name = U
    function = &#x27;x:=c/${cmax}; -(122.12*x^6-321.81*x^5+315.59*x^4-141.26*x^3+28.218*x^2-1.9057*x+0.0785)&#x27;
    args = c
    block = &#x27;anode&#x27;
  []
  [OCP_cathode_NMC111]
    type = ADParsedMaterial
    f_name = U
    function = &#x27;x:=c/${cmax}; (6.0826-6.9922*x+7.1062*x^2-5.4549e-5*exp(124.23*x-114.2593)-2.5947*x^3)&#x27;
    args = c
    block = &#x27;cathode&#x27;
  []
  [charge_transfer_anode_elyte]
    type = ChargeTransferReaction
    electrode = true
    charge_transfer_current_density = ie
    charge_transfer_mass_flux = je
    charge_transfer_heat_flux = he
    electric_potential = Phi
    neighbor_electric_potential = Phi
    charge_transfer_coefficient = 0.5
    exchange_current_density = ${i0_a}
    faraday_constant = ${F}
    ideal_gas_constant = ${R}
    temperature = T
    open_circuit_potential = U
    boundary = &#x27;anode_elyte&#x27;
  []
  [charge_transfer_elyte_anode]
    type = ChargeTransferReaction
    electrode = false
    charge_transfer_current_density = ie
    charge_transfer_mass_flux = je
    charge_transfer_heat_flux = he
    electric_potential = Phi
    neighbor_electric_potential = Phi
    charge_transfer_coefficient = 0.5
    exchange_current_density = ${i0_a}
    faraday_constant = ${F}
    ideal_gas_constant = ${R}
    temperature = T
    open_circuit_potential = U
    boundary = &#x27;elyte_anode&#x27;
  []
  [charge_transfer_cathode_elyte]
    type = ChargeTransferReaction
    electrode = true
    charge_transfer_current_density = ie
    charge_transfer_mass_flux = je
    charge_transfer_heat_flux = he
    electric_potential = Phi
    neighbor_electric_potential = Phi
    charge_transfer_coefficient = 0.5
    exchange_current_density = ${i0_c}
    faraday_constant = ${F}
    ideal_gas_constant = ${R}
    temperature = T
    open_circuit_potential = U
    boundary = &#x27;cathode_elyte&#x27;
  []
  [charge_transfer_elyte_cathode]
    type = ChargeTransferReaction
    electrode = false
    charge_transfer_current_density = ie
    charge_transfer_mass_flux = je
    charge_transfer_heat_flux = he
    electric_potential = Phi
    neighbor_electric_potential = Phi
    charge_transfer_coefficient = 0.5
    exchange_current_density = ${i0_c}
    faraday_constant = ${F}
    ideal_gas_constant = ${R}
    temperature = T
    open_circuit_potential = U
    boundary = &#x27;elyte_cathode&#x27;
  []

  # Thermal
  [thermal_properties]
    type = ADGenericConstantMaterial
    prop_names = &#x27;rho cv kappa&#x27;
    prop_values = &#x27;${rho} ${cv} ${kappa}&#x27;
  []
  [heat_conduction]
    type = FourierPotential
    thermal_energy_density = chi
    thermal_conductivity = kappa
    temperature = T
  []
  [heat_flux]
    type = HeatFlux
    heat_flux = h
    temperature = T
  []
  [heat_source]
    type = VariationalHeatSource
    heat_source = r
    temperature = T
  []

  # Mechanical
  [stiffness_c]
    type = ADGenericConstantMaterial
    prop_names = &#x27;lambda G&#x27;
    prop_values = &#x27;${fparse E_c*nu_c/(1+nu_c)/(1-2*nu_c)} ${fparse E_c/2/(1+nu_c)}&#x27;
    block = cathode
  []
  [stiffness_e]
    type = ADGenericConstantMaterial
    prop_names = &#x27;lambda G&#x27;
    prop_values = &#x27;${fparse E_e*nu_e/(1+nu_e)/(1-2*nu_e)} ${fparse E_e/2/(1+nu_e)}&#x27;
    block = elyte
  []
  [stiffness_a]
    type = ADGenericConstantMaterial
    prop_names = &#x27;lambda G&#x27;
    prop_values = &#x27;${fparse E_a*nu_a/(1+nu_a)/(1-2*nu_a)} ${fparse E_a/2/(1+nu_a)}&#x27;
    block = anode
  []
  [swelling_coefficient]
    type = ADGenericConstantMaterial
    prop_names = &#x27;beta&#x27;
    prop_values = &#x27;${beta}&#x27;
  []
  [swelling]
    type = SwellingDeformationGradient
    concentration = c
    reference_concentration = c_ref
    molar_volume = ${Omega}
    swelling_coefficient = beta
  []
  [thermal_expansion]
    type = ThermalDeformationGradient
    temperature = T
    reference_temperature = T_ref
    CTE = ${CTE}
  []
  [defgrad]
    type = MechanicalDeformationGradient
    displacements = &#x27;disp_x disp_y&#x27;
  []
  [neohookean]
    type = NeoHookeanSolid
    elastic_energy_density = psi_m
    lambda = lambda
    shear_modulus = G
    concentration = c
    temperature = T
  []
  [pk1]
    type = FirstPiolaKirchhoffStress
    first_piola_kirchhoff_stress = pk1
    deformation_gradient_rate = dot(F)
  []
[]

[Postprocessors]
  [V_l]
    type = SideAverageValue
    variable = Phi
    boundary = left
    outputs = none
    execute_on = &#x27;INITIAL TIMESTEP_END&#x27;
  []
  [V_r]
    type = SideAverageValue
    variable = Phi
    boundary = right
    outputs = none
    execute_on = &#x27;INITIAL TIMESTEP_END&#x27;
  []
  [V]
    type = ParsedPostprocessor
    function = &#x27;V_r - V_l&#x27;
    pp_names = &#x27;V_l V_r&#x27;
    execute_on = &#x27;INITIAL TIMESTEP_END&#x27;
  []
  [I]
    type = ADSideIntegralMaterialProperty
    property = i
    component = 0
    boundary = right
    execute_on = &#x27;INITIAL TIMESTEP_END&#x27;
  []
  [dt]
    type = TimestepSize
    outputs = none
    execute_on = &#x27;INITIAL TIMESTEP_END&#x27;
  []
  [dC]
    type = ParsedPostprocessor
    function = &#x27;-dt*I&#x27;
    pp_names = &#x27;dt I&#x27;
    outputs = none
    execute_on = &#x27;INITIAL TIMESTEP_END&#x27;
  []
  [C]
    type = CumulativeValuePostprocessor
    postprocessor = dC
    execute_on = &#x27;INITIAL TIMESTEP_END&#x27;
  []
  [c_a_max]
    type = NodalExtremeValue
    variable = c
    value_type = max
    block = anode
    execute_on = &#x27;INITIAL TIMESTEP_END&#x27;
  []
  [c_c_min]
    type = NodalExtremeValue
    variable = c
    value_type = min
    block = cathode
    execute_on = &#x27;INITIAL TIMESTEP_END&#x27;
  []
  [c_a_min]
    type = NodalExtremeValue
    variable = c
    value_type = min
    block = anode
    execute_on = &#x27;INITIAL TIMESTEP_END&#x27;
  []
  [c_c_max]
    type = NodalExtremeValue
    variable = c
    value_type = max
    block = cathode
    execute_on = &#x27;INITIAL TIMESTEP_END&#x27;
  []
  [mass_a]
    type = ElementIntegralVariablePostprocessor
    variable = c
    block = anode
    execute_on = &#x27;INITIAL TIMESTEP_END&#x27;
  []
  [mass_e]
    type = ElementIntegralVariablePostprocessor
    variable = c
    block = elyte
    execute_on = &#x27;INITIAL TIMESTEP_END&#x27;
  []
  [mass_c]
    type = ElementIntegralVariablePostprocessor
    variable = c
    block = cathode
    execute_on = &#x27;INITIAL TIMESTEP_END&#x27;
  []
[]

[UserObjects]
  [kill_i]
    type = Terminator
    expression = &#x27;-I &lt;= 1e-6&#x27;
    message = &#x27;No current.&#x27;
  []
[]

[Executioner]
  type = Transient
  solve_type = NEWTON

  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;
  automatic_scaling = true

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-10
  nl_max_its = 20

  [Predictor]
    type = SimplePredictor
    scale = 1
    skip_after_failed_timestep = true
  []
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = ${dt}
    optimal_iterations = 7
    iteration_window = 2
    growth_factor = 1.2
    cutback_factor = 0.5
    cutback_factor_at_failure = 0.2
    linear_iteration_ratio = 1000000
  []
  start_time = 0
  end_time = 100000

  steady_state_start_time = 10
  steady_state_detection = true
[]

[Outputs]
  file_base = &#x27;CV_charging_I_${I}&#x27;
  csv = true
  exodus = true
  print_linear_residuals = false
  checkpoint = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div></div><div class="col hide-on-med-and-down l2"><div class="toc-wrapper pin-top"><ul class="section table-of-contents"><li><a href="#037e8303-9bf8-4f2a-a9a7-6f06310f4049" class="tooltipped" data-position="left" data-tooltip="Overview">Overview</a></li><li><a href="#e6818109-2186-49b3-b69f-190164f5844d" class="tooltipped" data-position="left" data-tooltip="Example Input File Syntax">Example Input File Syntax</a></li><li><a href="#eefe8b6b-0513-4145-a11c-4aae0dd2981a" class="tooltipped" data-position="left" data-tooltip="Input Parameters">Input Parameters</a></li><li><a href="#3b7c4eea-228f-41c9-813f-b36c95cdb3a5" class="tooltipped" data-position="left" data-tooltip="Input Files">Input Files</a></li></ul></div></div></div></div></main></div></body><script type="text/javascript" src="../../contrib/materialize/materialize.min.js"></script><script type="text/javascript" src="../../contrib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="../../contrib/prism/prism.min.js"></script><script type="text/javascript" src="../../js/init.js"></script><script type="text/javascript" src="../../js/navigation.js"></script><script type="text/javascript" src="../../contrib/fuse/fuse.min.js"></script><script type="text/javascript" src="../../js/search_index.js"></script><script type="text/javascript" src="../../js/sqa_moose.js"></script>